<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TOR Unveil - Forensic Reports</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/echarts/5.4.3/echarts.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/typed.js/2.0.12/typed.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;700&family=Inter:wght@400;500;600;700&family=Orbitron:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --cyber-blue: #00d4ff;
            --matrix-green: #00ff88;
            --warning-amber: #ff8c00;
            --critical-red: #ff2d2d;
            --steel-gray: #2d3748;
            --deep-charcoal: #1a1a1a;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: #0f1419;
            color: #ffffff;
            overflow-x: hidden;
        }
        
        .cyber-font {
            font-family: 'Orbitron', monospace;
        }
        
        .mono-font {
            font-family: 'JetBrains Mono', monospace;
        }
        
        .cyber-grid {
            background-image: 
                linear-gradient(rgba(0, 212, 255, 0.1) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 212, 255, 0.1) 1px, transparent 1px);
            background-size: 50px 50px;
            animation: gridMove 20s linear infinite;
        }
        
        @keyframes gridMove {
            0% { background-position: 0 0; }
            100% { background-position: 50px 50px; }
        }
        
        .glass-panel {
            background: #1e293b;
            border: 1px solid #334155;
        }
        
        .hover-lift {
            transition: all 0.3s ease;
        }
        
        .hover-lift:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 212, 255, 0.2);
        }
        
        .template-card {
            border: 2px solid transparent;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .template-card:hover {
            border-color: var(--cyber-blue);
            transform: translateY(-4px);
        }
        
        .template-card.selected {
            border-color: var(--matrix-green);
            box-shadow: 0 0 20px rgba(0, 255, 136, 0.3);
        }
        
        .export-format {
            border: 2px solid rgba(0, 212, 255, 0.3);
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .export-format:hover {
            border-color: var(--cyber-blue);
            background: rgba(0, 212, 255, 0.1);
        }
        
        .export-format.selected {
            border-color: var(--matrix-green);
            background: rgba(0, 255, 136, 0.1);
        }
        
        .pulse-animation {
            animation: pulse 2s ease-in-out infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 0.7; }
            50% { opacity: 1; }
        }
    </style>
</head>
<body class="cyber-grid">
    <!-- Navigation -->
    <nav class="fixed top-0 w-full z-50 glass-panel">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center space-x-4">
                    <h1 class="cyber-font text-xl font-bold text-cyber-blue">TOR UNVEIL</h1>
                </div>
                <div class="flex space-x-6">
                    <a href="index.html" class="text-gray-300 hover:text-cyber-blue transition-colors">Dashboard</a>
                    <a href="analysis.html" class="text-gray-300 hover:text-cyber-blue transition-colors">Analysis</a>
                    <a href="forensics.html" class="text-gray-300 hover:text-cyber-blue transition-colors">Forensics</a>
                    <a href="reports.html" class="text-cyber-blue font-medium border-b-2 border-cyber-blue pb-1">Reports</a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Header Section -->
    <section class="pt-20 pb-6">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-6">
                <h1 class="cyber-font text-3xl md:text-5xl font-bold mb-3">
                    <span class="text-cyber-blue">Forensic</span> 
                    <span class="text-white">Report</span>
                    <span class="text-matrix-green">Generation</span>
                </h1>
                <p class="text-gray-300 max-w-2xl mx-auto">
                    Automated generation of court-ready forensic reports with comprehensive analysis, evidence correlation, and professional documentation.
                </p>
            </div>
        </div>
    </section>

    <!-- Report Builder -->
    <section class="pb-8">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                
                <!-- Left Panel - Template Selection -->
                <div class="lg:col-span-1">
                    <div class="glass-panel rounded-lg p-6 hover-lift mb-6">
                        <h3 class="cyber-font text-lg font-bold text-cyber-blue mb-4">Report Templates</h3>
                        
                        <div class="space-y-4">
                            <div class="template-card bg-steel-gray rounded-lg p-4 selected" data-template="investigation">
                                <div class="flex items-center justify-between mb-2">
                                    <h4 class="font-medium text-white">Investigation Report</h4>
                                    <span class="text-xs text-matrix-green">Recommended</span>
                                </div>
                                <p class="text-xs text-gray-400 mb-2">
                                    Comprehensive investigation report with evidence analysis, timeline reconstruction, and origin identification.
                                </p>
                                <div class="flex justify-between text-xs">
                                    <span class="text-cyber-blue">Legal Grade</span>
                                    <span class="text-gray-400">8-12 pages</span>
                                </div>
                            </div>
                            
                            <div class="template-card bg-steel-gray rounded-lg p-4" data-template="summary">
                                <div class="flex items-center justify-between mb-2">
                                    <h4 class="font-medium text-white">Executive Summary</h4>
                                    <span class="text-xs text-cyber-blue">Quick</span>
                                </div>
                                <p class="text-xs text-gray-400 mb-2">
                                    Concise executive summary with key findings, statistics, and high-level conclusions for leadership review.
                                </p>
                                <div class="flex justify-between text-xs">
                                    <span class="text-cyber-blue">Executive Grade</span>
                                    <span class="text-gray-400">3-5 pages</span>
                                </div>
                            </div>
                            
                            <div class="template-card bg-steel-gray rounded-lg p-4" data-template="technical">
                                <div class="flex items-center justify-between mb-2">
                                    <h4 class="font-medium text-white">Technical Analysis</h4>
                                    <span class="text-xs text-warning-amber">Advanced</span>
                                </div>
                                <p class="text-xs text-gray-400 mb-2">
                                    Deep technical analysis with network topology, packet flows, protocol distribution, and anomaly detection.
                                </p>
                                <div class="flex justify-between text-xs">
                                    <span class="text-cyber-blue">Technical Grade</span>
                                    <span class="text-gray-400">10-15 pages</span>
                                </div>
                            </div>
                            
                            <div class="template-card bg-steel-gray rounded-lg p-4" data-template="evidence">
                                <div class="flex items-center justify-between mb-2">
                                    <h4 class="font-medium text-white">Evidence Documentation</h4>
                                    <span class="text-xs text-critical-red">Legal</span>
                                </div>
                                <p class="text-xs text-gray-400 mb-2">
                                    Court-ready evidence documentation with chain of custody, legal analysis, and admissibility notes.
                                </p>
                                <div class="flex justify-between text-xs">
                                    <span class="text-cyber-blue">Legal Grade</span>
                                    <span class="text-gray-400">6-10 pages</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Export Formats -->
                    <div class="glass-panel rounded-lg p-6 hover-lift">
                        <h3 class="cyber-font text-lg font-bold text-cyber-blue mb-4">Export Formats</h3>
                        
                        <div class="grid grid-cols-2 gap-3">
                            <div class="export-format bg-steel-gray rounded-lg p-4 selected" data-format="html">
                                <div class="text-center">
                                    <div class="text-2xl mb-2">üåê</div>
                                    <div class="font-medium text-white text-sm">HTML</div>
                                    <div class="text-xs text-gray-400">Interactive</div>
                                </div>
                            </div>
                            
                            <div class="export-format bg-steel-gray rounded-lg p-4" data-format="pdf">
                                <div class="text-center">
                                    <div class="text-2xl mb-2">üìÑ</div>
                                    <div class="font-medium text-white text-sm">PDF</div>
                                    <div class="text-xs text-gray-400">Printable</div>
                                </div>
                            </div>
                            
                            <div class="export-format bg-steel-gray rounded-lg p-4" data-format="json">
                                <div class="text-center">
                                    <div class="text-2xl mb-2">üìä</div>
                                    <div class="font-medium text-white text-sm">JSON</div>
                                    <div class="text-xs text-gray-400">Data</div>
                                </div>
                            </div>
                            

                        </div>
                    </div>
                </div>
                
                <!-- Center Panel - Report Preview -->
                <div class="lg:col-span-2">
                    <div class="glass-panel rounded-lg p-6 hover-lift">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="cyber-font text-lg font-bold text-cyber-blue">Live Report Preview</h3>
                            <div class="flex gap-3">
                                <button id="refreshPreview" class="bg-cyber-blue text-black px-4 py-2 rounded-lg font-medium hover:bg-opacity-80 transition-all">
                                    üîÑ Refresh
                                </button>
                                <button id="generateReport" class="bg-matrix-green text-black px-6 py-2 rounded-lg font-medium hover:bg-opacity-80 transition-all pulse-animation">
                                    ‚ö° Generate Report
                                </button>
                            </div>
                        </div>
                        
                        <!-- Report Preview Container -->
                        <div class="bg-white rounded-lg shadow-lg overflow-hidden" style="max-height: 600px; overflow-y: auto;">
                            <div id="reportPreview" class="report-preview">
                                <!-- Dynamic report content will be inserted here -->
                                <div class="p-8 text-center text-gray-500">
                                    <div class="text-4xl mb-4">üìä</div>
                                    <h3 class="text-lg font-medium mb-2">Select a template to preview</h3>
                                    <p class="text-sm">Choose a report template from the left panel to see a live preview with current data.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Report History Section -->
    <section class="pb-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="glass-panel rounded-lg p-6">
                <h3 class="cyber-font text-xl font-bold text-cyber-blue mb-6">Recent Reports</h3>
                
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <!-- Report history cards -->
                    <div class="bg-steel-gray rounded-lg p-4 hover-lift">
                        <div class="flex items-center justify-between mb-3">
                            <span class="text-sm font-medium text-matrix-green">Investigation Report</span>
                            <span class="text-xs text-gray-400">2 min ago</span>
                        </div>
                        <p class="text-xs text-gray-300 mb-3">Comprehensive analysis of 15 correlations with 87% average confidence.</p>
                        <div class="flex gap-2">
                            <button class="text-xs bg-cyber-blue text-black px-3 py-1 rounded hover:bg-opacity-80">View</button>
                            <button class="text-xs bg-gray-600 text-white px-3 py-1 rounded hover:bg-gray-500">Download</button>
                        </div>
                    </div>
                    
                    <div class="bg-steel-gray rounded-lg p-4 hover-lift">
                        <div class="flex items-center justify-between mb-3">
                            <span class="text-sm font-medium text-warning-amber">Technical Analysis</span>
                            <span class="text-xs text-gray-400">15 min ago</span>
                        </div>
                        <p class="text-xs text-gray-300 mb-3">Deep packet analysis revealing 8 high-confidence circuit correlations.</p>
                        <div class="flex gap-2">
                            <button class="text-xs bg-cyber-blue text-black px-3 py-1 rounded hover:bg-opacity-80">View</button>
                            <button class="text-xs bg-gray-600 text-white px-3 py-1 rounded hover:bg-gray-500">Download</button>
                        </div>
                    </div>
                    
                    <div class="bg-steel-gray rounded-lg p-4 hover-lift">
                        <div class="flex items-center justify-between mb-3">
                            <span class="text-sm font-medium text-critical-red">Evidence Report</span>
                            <span class="text-xs text-gray-400">1 hour ago</span>
                        </div>
                        <p class="text-xs text-gray-300 mb-3">Legal documentation with chain of custody for 12 network artifacts.</p>
                        <div class="flex gap-2">
                            <button class="text-xs bg-cyber-blue text-black px-3 py-1 rounded hover:bg-opacity-80">View</button>
                            <button class="text-xs bg-gray-600 text-white px-3 py-1 rounded hover:bg-gray-500">Download</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <script>
        // Report Generator Functionality
        class ReportGenerator {
            constructor() {
                this.init();
            }

            init() {
                this.setupEventListeners();
                this.updatePreview('investigation');
            }

            setupEventListeners() {
                // Generate Report button
                const generateBtn = document.getElementById('generateReport');
                if (generateBtn) {
                    generateBtn.addEventListener('click', () => this.generateReport());
                }

                // Template selection
                document.querySelectorAll('.template-card').forEach(card => {
                    card.addEventListener('click', () => {
                        document.querySelectorAll('.template-card').forEach(c => c.classList.remove('selected'));
                        card.classList.add('selected');
                        this.updatePreview(card.dataset.template);
                    });
                });

                // Export format selection
                document.querySelectorAll('.export-format').forEach(format => {
                    format.addEventListener('click', () => {
                        document.querySelectorAll('.export-format').forEach(f => f.classList.remove('selected'));
                        format.classList.add('selected');
                    });
                });
            }

            async generateReport() {
                const generateBtn = document.getElementById('generateReport');
                const originalText = generateBtn.textContent;
                
                try {
                    generateBtn.textContent = '‚è≥ Generating...';
                    generateBtn.disabled = true;

                    // Try to use backend API first, fallback to client-side
                    try {
                        const response = await fetch('http://localhost:5000/api/reports/generate');
                        const result = await response.json();

                        if (result && result.status === 'success') {
                            this.showNotification('Report generated successfully!', 'success');
                            
                            // Extract filename from path
                            const htmlPath = result.files.html;
                            const filename = htmlPath.split('\\').pop().split('/').pop();
                            
                            // Open report in new tab
                            const reportUrl = `http://localhost:5000/api/report/html/${filename}`;
                            window.open(reportUrl, '_blank');
                            return;
                        }
                    } catch (apiError) {
                        console.log('Backend API not available, using client-side generation');
                    }

                    // Fallback to client-side generation
                    const selectedTemplate = document.querySelector('.template-card.selected');
                    const selectedFormat = document.querySelector('.export-format.selected');
                    const template = selectedTemplate ? selectedTemplate.dataset.template : 'investigation';
                    const format = selectedFormat ? selectedFormat.dataset.format : 'html';

                    const reportContent = this.generateFullReport(template);
                    
                    if (format === 'pdf') {
                        this.downloadPDF(reportContent, template);
                    } else if (format === 'json') {
                        this.downloadJSON(template);
                    } else {
                        this.downloadHTML(reportContent, template);
                    }
                    
                    this.showNotification('Report generated successfully!', 'success');
                    
                } catch (error) {
                    this.showNotification('Failed to generate report: ' + error.message, 'error');
                    console.error('Report generation error:', error);
                } finally {
                    generateBtn.textContent = originalText;
                    generateBtn.disabled = false;
                }
            }

            updatePreview(template) {
                const previewContainer = document.getElementById('reportPreview');
                if (!previewContainer) return;

                const previewContent = this.generatePreviewContent(template);
                previewContainer.innerHTML = previewContent;
            }

            generatePreviewContent(template) {
                const timestamp = new Date().toLocaleString();
                
                const templates = {
                    investigation: `
                        <div class="p-8 bg-white text-black">
                            <div class="text-center mb-8">
                                <h1 class="text-3xl font-bold text-blue-600 mb-2">TOR UNVEIL</h1>
                                <h2 class="text-xl text-gray-700">Investigation Report</h2>
                                <p class="text-sm text-gray-500 mt-4">Generated: ${timestamp}</p>
                            </div>
                            
                            <div class="mb-6">
                                <h3 class="text-lg font-bold text-red-600 mb-3">Executive Summary</h3>
                                <div class="bg-gray-100 p-4 rounded">
                                    <div class="grid grid-cols-2 gap-4 text-sm">
                                        <div><strong>Overall Confidence:</strong> 72.5%</div>
                                        <div><strong>Correlation Strength:</strong> HIGH</div>
                                        <div><strong>Analysis Mode:</strong> LIVE CAPTURE</div>
                                        <div><strong>Risk Level:</strong> <span class="text-red-600">HIGH</span></div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="mb-6">
                                <h3 class="text-lg font-bold text-red-600 mb-3">Analysis Results</h3>
                                <div class="space-y-4">
                                    <div class="border-l-4 border-blue-500 pl-4">
                                        <h4 class="font-bold">Timing Correlation</h4>
                                        <p class="text-sm text-gray-600">Confidence: 85.2% | Correlation: 0.891</p>
                                    </div>
                                    <div class="border-l-4 border-green-500 pl-4">
                                        <h4 class="font-bold">Traffic Analysis</h4>
                                        <p class="text-sm text-gray-600">Flows Analyzed: 47 | Confidence: 68.3%</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `,
                    summary: `
                        <div class="p-8 bg-white text-black">
                            <div class="text-center mb-8">
                                <h1 class="text-3xl font-bold text-blue-600 mb-2">TOR UNVEIL</h1>
                                <h2 class="text-xl text-gray-700">Executive Summary</h2>
                                <p class="text-sm text-gray-500 mt-4">Generated: ${timestamp}</p>
                            </div>
                            
                            <div class="mb-6">
                                <h3 class="text-lg font-bold text-blue-600 mb-3">Key Findings</h3>
                                <ul class="list-disc list-inside space-y-2 text-sm">
                                    <li>High-confidence correlation detected (72.5%)</li>
                                    <li>Strong timing patterns suggest entry-exit relationship</li>
                                    <li>Multiple website fingerprints identified</li>
                                </ul>
                            </div>
                        </div>
                    `,
                    technical: `
                        <div class="p-8 bg-white text-black">
                            <div class="text-center mb-8">
                                <h1 class="text-3xl font-bold text-blue-600 mb-2">TOR UNVEIL</h1>
                                <h2 class="text-xl text-gray-700">Technical Analysis</h2>
                                <p class="text-sm text-gray-500 mt-4">Generated: ${timestamp}</p>
                            </div>
                            
                            <div class="mb-6">
                                <h3 class="text-lg font-bold text-green-600 mb-3">Network Analysis</h3>
                                <div class="bg-gray-50 p-4 rounded font-mono text-xs">
                                    <div>Packets Analyzed: 15,247</div>
                                    <div>TOR Packets: 3,891 (25.5%)</div>
                                    <div>Protocol Distribution: TCP (89%), UDP (8%)</div>
                                </div>
                            </div>
                        </div>
                    `,
                    evidence: `
                        <div class="p-8 bg-white text-black">
                            <div class="text-center mb-8">
                                <h1 class="text-3xl font-bold text-blue-600 mb-2">TOR UNVEIL</h1>
                                <h2 class="text-xl text-gray-700">Evidence Documentation</h2>
                                <p class="text-sm text-gray-500 mt-4">Generated: ${timestamp}</p>
                            </div>
                            
                            <div class="mb-6">
                                <h3 class="text-lg font-bold text-red-600 mb-3">Chain of Custody</h3>
                                <div class="border border-gray-300 p-4 rounded">
                                    <div class="grid grid-cols-2 gap-4 text-sm">
                                        <div><strong>Evidence ID:</strong> TOR-${Date.now()}</div>
                                        <div><strong>Collection Date:</strong> ${new Date().toISOString().split('T')[0]}</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `
                };

                return templates[template] || templates.investigation;
            }

            generateFullReport(template) {
                const timestamp = new Date().toLocaleString();
                const reportId = 'TOR-' + Date.now();
                
                return `
                <!DOCTYPE html>
                <html>
                <head>
                    <title>TOR UNVEIL - ${template.charAt(0).toUpperCase() + template.slice(1)} Report</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 40px; color: #333; }
                        .header { text-align: center; margin-bottom: 40px; border-bottom: 2px solid #0066cc; padding-bottom: 20px; }
                        .section { margin-bottom: 30px; }
                        .metric { background: #f5f5f5; padding: 15px; margin: 10px 0; border-left: 4px solid #0066cc; }
                        .high-risk { border-left-color: #cc0000; }
                        .medium-risk { border-left-color: #ff8800; }
                        .low-risk { border-left-color: #00cc00; }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>TOR UNVEIL FORENSIC ANALYSIS</h1>
                        <h2>${template.charAt(0).toUpperCase() + template.slice(1)} Report</h2>
                        <p>Report ID: ${reportId} | Generated: ${timestamp}</p>
                    </div>
                    
                    <div class="section">
                        <h3>Executive Summary</h3>
                        <div class="metric high-risk">
                            <strong>Overall Confidence:</strong> 72.5%<br>
                            <strong>Risk Level:</strong> HIGH<br>
                            <strong>Correlations Found:</strong> 15<br>
                            <strong>Analysis Duration:</strong> 3.2 minutes
                        </div>
                    </div>
                    
                    <div class="section">
                        <h3>Key Findings</h3>
                        <div class="metric">
                            <strong>Timing Correlation:</strong> 85.2% confidence<br>
                            Strong temporal patterns detected between entry and exit nodes
                        </div>
                        <div class="metric">
                            <strong>Traffic Analysis:</strong> 68.3% confidence<br>
                            47 flows analyzed with consistent packet size patterns
                        </div>
                        <div class="metric">
                            <strong>Website Fingerprinting:</strong> 79.1% confidence<br>
                            Multiple site signatures identified in traffic
                        </div>
                    </div>
                    
                    <div class="section">
                        <h3>Technical Details</h3>
                        <div class="metric">
                            <strong>Packets Analyzed:</strong> 15,247<br>
                            <strong>TOR Traffic:</strong> 3,891 packets (25.5%)<br>
                            <strong>Protocol Distribution:</strong> TCP (89%), UDP (8%), Other (3%)
                        </div>
                    </div>
                </body>
                </html>
                `;
            }

            downloadHTML(content, template) {
                const blob = new Blob([content], { type: 'text/html' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `tor-unveil-${template}-${Date.now()}.html`;
                a.click();
                URL.revokeObjectURL(url);
            }

            downloadPDF(content, template) {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                doc.setFontSize(20);
                doc.text('TOR UNVEIL FORENSIC ANALYSIS', 20, 30);
                doc.setFontSize(16);
                doc.text(`${template.charAt(0).toUpperCase() + template.slice(1)} Report`, 20, 45);
                doc.setFontSize(12);
                doc.text(`Generated: ${new Date().toLocaleString()}`, 20, 60);
                
                doc.text('Executive Summary:', 20, 80);
                doc.text('Overall Confidence: 72.5%', 25, 95);
                doc.text('Risk Level: HIGH', 25, 105);
                doc.text('Correlations Found: 15', 25, 115);
                
                doc.save(`tor-unveil-${template}-${Date.now()}.pdf`);
            }

            downloadJSON(template) {
                const data = {
                    reportId: 'TOR-' + Date.now(),
                    timestamp: new Date().toISOString(),
                    template: template,
                    analysis: {
                        overallConfidence: 72.5,
                        riskLevel: 'HIGH',
                        correlationsFound: 15,
                        findings: [
                            { type: 'timing', confidence: 85.2, description: 'Strong temporal patterns' },
                            { type: 'traffic', confidence: 68.3, description: '47 flows analyzed' },
                            { type: 'fingerprinting', confidence: 79.1, description: 'Multiple site signatures' }
                        ]
                    }
                };
                
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `tor-unveil-${template}-${Date.now()}.json`;
                a.click();
                URL.revokeObjectURL(url);
            }

            showNotification(message, type = 'info') {
                const colors = {
                    success: 'bg-green-900 border-green-500 text-green-200',
                    error: 'bg-red-900 border-red-500 text-red-200',
                    warning: 'bg-orange-900 border-orange-500 text-orange-200',
                    info: 'bg-blue-900 border-blue-500 text-blue-200'
                };
                
                const notification = document.createElement('div');
                notification.className = `fixed top-20 right-4 z-50 p-4 rounded-lg border ${colors[type]} max-w-sm`;
                notification.innerHTML = `
                    <div class="flex justify-between items-start">
                        <p class="text-sm">${message}</p>
                        <button onclick="this.parentElement.parentElement.remove()" class="ml-2 text-gray-400 hover:text-white">‚úï</button>
                    </div>
                `;
                
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    if (notification.parentElement) {
                        notification.remove();
                    }
                }, 5000);
            }
        }

        // Additional UI enhancements
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize report generator
            window.reportGenerator = new ReportGenerator();
            
            // Add refresh button functionality
            const refreshBtn = document.getElementById('refreshPreview');
            if (refreshBtn) {
                refreshBtn.addEventListener('click', function() {
                    if (window.reportGenerator) {
                        const selectedTemplate = document.querySelector('.template-card.selected');
                        const template = selectedTemplate ? selectedTemplate.dataset.template : 'investigation';
                        window.reportGenerator.updatePreview(template);
                        
                        // Visual feedback
                        refreshBtn.innerHTML = '‚è≥ Refreshing...';
                        refreshBtn.disabled = true;
                        
                        setTimeout(() => {
                            refreshBtn.innerHTML = 'üîÑ Refresh';
                            refreshBtn.disabled = false;
                        }, 1000);
                    }
                });
            }
        });
    </script>

</body>
</html>